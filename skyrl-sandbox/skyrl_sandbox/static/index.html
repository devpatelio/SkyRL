<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkyRL Sandbox - Environment Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        [x-cloak] {
            display: none !important;
        }
        
        body {
            background: #000000;
            color: #ffffff;
            min-height: 100vh;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #111827;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #374151;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #4b5563;
        }
        
        /* Input fields */
        .input-field {
            width: 100%;
            padding: 0.625rem 1rem;
            background-color: #1f2937;
            border: 1px solid #4b5563;
            border-radius: 0.5rem;
            color: #ffffff;
            transition: all 0.2s;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        .input-field::placeholder {
            color: #9ca3af;
        }
        
        /* Select fields */
        .select-field {
            width: 100%;
            padding: 0.625rem 1rem;
            background-color: #1f2937;
            border: 1px solid #4b5563;
            border-radius: 0.5rem;
            color: #ffffff;
            transition: all 0.2s;
        }
        
        .select-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        .select-field option {
            background-color: #1f2937;
            color: #ffffff;
        }
        
        /* Buttons */
        .btn {
            width: 100%;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            border-radius: 0.5rem;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            font-size: 0.875rem;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn:disabled:hover {
            transform: none !important;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05) !important;
        }
        
        .btn-primary {
            background-color: #2563eb;
            color: #ffffff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary:hover:not(:disabled) {
            background-color: #1d4ed8;
            transform: translateY(-1px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary:focus {
            outline: none;
            ring: 2px;
            ring-offset: 2px;
            ring-color: #3b82f6;
            ring-offset-color: #000000;
        }
        
        .btn-success {
            background-color: #16a34a;
            color: #ffffff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .btn-success:hover:not(:disabled) {
            background-color: #15803d;
            transform: translateY(-1px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .btn-success:focus {
            outline: none;
            ring: 2px;
            ring-offset: 2px;
            ring-color: #22c55e;
            ring-offset-color: #000000;
        }
        
        /* Cards */
        .card {
            background-color: #111827;
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            border: 1px solid #1f2937;
        }
        
        /* Section headers */
        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #1f2937;
        }
        
        .section-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            border-radius: 0.5rem;
            background-color: #1e3a8a;
            color: #93c5fd;
            font-weight: 700;
            font-size: 0.875rem;
        }
        
        /* Form groups */
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: #d1d5db;
        }
        
        .helper-text {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        
        /* Toggle group */
        .toggle-group {
            display: inline-flex;
            border-radius: 0.5rem;
            background-color: #1f2937;
            padding: 0.25rem;
        }
        
        .toggle-btn {
            padding: 0.5rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 0.375rem;
            transition: all 0.2s;
            border: none;
            background: transparent;
            color: #9ca3af;
            cursor: pointer;
        }
        
        .toggle-btn.active {
            background-color: #111827;
            color: #93c5fd;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        
        .toggle-btn:not(.active):hover {
            color: #e5e7eb;
        }
        
        /* Result cards */
        .result-card {
            padding: 1rem;
            border-radius: 0.5rem;
            border: 2px solid;
        }
        
        .result-card.success {
            background-color: #064e3b;
            border-color: #065f46;
        }
        
        .result-card.error {
            background-color: #7f1d1d;
            border-color: #991b1b;
        }
        
        .result-card.info {
            background-color: #1e3a8a;
            border-color: #1e40af;
        }
        
        /* Spec items */
        .spec-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            background-color: #1f2937;
            border-radius: 0.5rem;
            border: 1px solid #374151;
            transition: all 0.2s;
        }
        
        .spec-item:hover {
            border-color: #3b82f6;
            background-color: #374151;
        }
        
        .icon-btn {
            font-size: 0.875rem;
            font-weight: 500;
            transition: color 0.15s;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }
        
        .icon-btn:hover {
            background-color: #111827;
        }
        
        /* Header */
        .header-gradient {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Checkbox */
        input[type="checkbox"] {
            width: 1rem;
            height: 1rem;
            border: 1px solid #4b5563;
            border-radius: 0.25rem;
            background-color: #1f2937;
            cursor: pointer;
        }
        
        input[type="checkbox"]:checked {
            background-color: #2563eb;
            border-color: #2563eb;
        }
        
        input[type="checkbox"]:focus {
            outline: none;
            ring: 2px;
            ring-color: #3b82f6;
        }
    </style>
</head>
<body x-data="envBuilder()">
    <!-- Header -->
    <header class="header-gradient text-white shadow-2xl">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-4xl font-bold tracking-tight">SkyRL Sandbox</h1>
                    <p class="text-gray-400 mt-2 text-lg">Build custom reinforcement learning environments with ease</p>
                </div>
                <div class="hidden md:flex items-center gap-6 text-sm">
                    <div class="text-right">
                        <div class="text-gray-500 text-xs uppercase tracking-wide">Environment Builder</div>
                        <div class="text-white font-semibold mt-0.5">Version 0.1.0</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 min-h-screen">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
            
            <!-- Left Panel - Configuration -->
            <div class="lg:col-span-2 space-y-8">
                
                <!-- Basic Configuration -->
                <section class="card">
                    <div class="p-6 section-header">
                        <span class="section-number">1</span>
                        <div>
                            <h2 class="text-xl font-bold text-white">Basic Configuration</h2>
                            <p class="text-sm text-gray-400 mt-0.5">Define the core properties of your environment</p>
                        </div>
                    </div>
                    <div class="p-6 space-y-5">
                        <div class="form-group">
                            <label class="label">Environment Name</label>
                            <input 
                                type="text" 
                                x-model="spec.env_name" 
                                placeholder="multiply" 
                                class="input-field"
                            />
                            <p class="helper-text">Use lowercase letters, numbers, and underscores only</p>
                        </div>

                        <div class="form-group">
                            <label class="label">Environment Type</label>
                            <div class="toggle-group">
                                <button 
                                    @click="spec.env_type = 'single_turn'" 
                                    :class="{'active': spec.env_type === 'single_turn'}"
                                    class="toggle-btn"
                                >
                                    Single Turn
                                </button>
                                <button 
                                    @click="spec.env_type = 'multi_turn'" 
                                    :class="{'active': spec.env_type === 'multi_turn'}"
                                    class="toggle-btn"
                                >
                                    Multi Turn
                                </button>
                            </div>
                        </div>

                        <div x-show="spec.env_type === 'multi_turn'" x-cloak class="form-group">
                            <label class="label">Maximum Turns</label>
                            <input 
                                type="number" 
                                x-model.number="spec.max_turns" 
                                min="1" 
                                max="20" 
                                class="input-field"
                                style="width: 8rem;"
                            />
                            <p class="helper-text">Maximum number of interactions before episode ends</p>
                        </div>

                        <div class="form-group">
                            <label class="label">Description <span class="text-gray-500 font-normal">(optional)</span></label>
                            <textarea 
                                x-model="spec.description" 
                                rows="3" 
                                placeholder="Describe what this environment does and its purpose"
                                class="input-field resize-none"
                            ></textarea>
                        </div>
                    </div>
                </section>

                <!-- Parsing Logic -->
                <section class="card">
                    <div class="p-6 section-header">
                        <span class="section-number">2</span>
                        <div>
                            <h2 class="text-xl font-bold text-white">Answer Parsing</h2>
                            <p class="text-sm text-gray-400 mt-0.5">Extract the model's answer from its output</p>
                        </div>
                    </div>
                    <div class="p-6 space-y-5">
                        <div class="form-group">
                            <label class="label">Parsing Method</label>
                            <select x-model="spec.parsing.method" class="select-field">
                                <option value="regex">Regular Expression</option>
                                <option value="json_path">JSON Path</option>
                            </select>
                        </div>

                        <div x-show="spec.parsing.method === 'regex'" x-cloak class="form-group">
                            <label class="label">Regular Expression Pattern</label>
                            <input 
                                type="text" 
                                x-model="spec.parsing.pattern" 
                                placeholder="\boxed\{([^}]+)\}"
                                class="input-field font-mono text-sm"
                            />
                            <p class="helper-text">Use a capturing group to extract the answer</p>
                        </div>

                        <div x-show="spec.parsing.method === 'json_path'" x-cloak class="form-group">
                            <label class="label">JSON Path Expression</label>
                            <input 
                                type="text" 
                                x-model="spec.parsing.json_path" 
                                placeholder="$.answer"
                                class="input-field font-mono text-sm"
                            />
                            <p class="helper-text">JSONPath to navigate and extract the answer field</p>
                        </div>
                    </div>
                </section>

                <!-- Reward Configuration -->
                <section class="card">
                    <div class="p-6 section-header">
                        <span class="section-number">3</span>
                        <div>
                            <h2 class="text-xl font-bold text-white">Reward Configuration</h2>
                            <p class="text-sm text-gray-400 mt-0.5">Define how to score the model's responses</p>
                        </div>
                    </div>
                    <div class="p-6 space-y-5">
                        <div class="form-group">
                            <label class="label">Reward Method</label>
                            <select x-model="spec.reward.method" class="select-field">
                                <option value="exact_match">Exact String Match</option>
                                <option value="regex_match">Regular Expression Match</option>
                                <option value="numeric_tolerance">Numeric Tolerance</option>
                            </select>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="label">Correct Reward</label>
                                <input 
                                    type="number" 
                                    step="0.1" 
                                    x-model.number="spec.reward.correct_reward" 
                                    class="input-field"
                                />
                            </div>
                            <div class="form-group">
                                <label class="label">Incorrect Reward</label>
                                <input 
                                    type="number" 
                                    step="0.1" 
                                    x-model.number="spec.reward.incorrect_reward" 
                                    class="input-field"
                                />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input 
                                    type="checkbox" 
                                    x-model="usePartialReward"
                                />
                                <span class="text-sm font-medium text-gray-300">Enable partial reward for correct format</span>
                            </label>
                            <input 
                                x-show="usePartialReward" 
                                x-cloak 
                                type="number" 
                                step="0.1" 
                                x-model.number="spec.reward.partial_reward" 
                                placeholder="0.5"
                                class="input-field mt-2"
                            />
                        </div>

                        <div x-show="spec.reward.method === 'numeric_tolerance'" x-cloak class="form-group">
                            <label class="label">Numeric Tolerance</label>
                            <input 
                                type="number" 
                                step="0.001" 
                                x-model.number="spec.reward.tolerance" 
                                placeholder="0.01"
                                class="input-field"
                            />
                            <p class="helper-text">Acceptable difference between answer and ground truth</p>
                        </div>

                        <div class="form-group">
                            <label class="label">Episode Termination</label>
                            <select x-model="spec.done_condition" class="select-field">
                                <option value="always_single_step">End after one step</option>
                                <option value="max_turns_only">End at maximum turns</option>
                                <option value="correct_or_max_turns">End when correct or at max turns</option>
                            </select>
                        </div>
                    </div>
                </section>

                <!-- Feedback Messages -->
                <section class="card" x-show="spec.env_type === 'multi_turn'" x-cloak>
                    <div class="p-6 section-header">
                        <span class="section-number">4</span>
                        <div>
                            <h2 class="text-xl font-bold text-white">Feedback Messages</h2>
                            <p class="text-sm text-gray-400 mt-0.5">Customize feedback for multi-turn interactions</p>
                        </div>
                    </div>
                    <div class="p-6 space-y-5">
                        <div class="form-group">
                            <label class="label">Incorrect Answer Feedback</label>
                            <textarea 
                                x-model="spec.feedback.on_incorrect" 
                                rows="2"
                                class="input-field resize-none"
                            ></textarea>
                            <p class="helper-text">Use {answer} to reference the parsed answer</p>
                        </div>

                        <div class="form-group">
                            <label class="label">Format Error Feedback</label>
                            <textarea 
                                x-model="spec.feedback.on_format_error" 
                                rows="2"
                                class="input-field resize-none"
                            ></textarea>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Right Panel - Testing & Export -->
            <div class="space-y-8 lg:sticky lg:top-8">
                
                <!-- Test Preview -->
                <section class="card">
                    <div class="p-6 border-b border-gray-800">
                        <h2 class="text-lg font-bold text-white">Test Configuration</h2>
                        <p class="text-sm text-gray-400 mt-1">Validate your logic with sample data</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <div class="form-group">
                            <label class="label">Model Output</label>
                            <textarea 
                                x-model="preview.model_output" 
                                rows="3"
                                placeholder="Paste sample model output here"
                                class="input-field resize-none font-mono text-sm"
                            ></textarea>
                        </div>

                        <div class="form-group">
                            <label class="label">Ground Truth</label>
                            <input 
                                type="text" 
                                x-model="preview.ground_truth" 
                                placeholder="Expected correct answer"
                                class="input-field"
                            />
                        </div>

                        <div x-show="spec.env_type === 'multi_turn'" x-cloak class="form-group">
                            <label class="label">Current Turn</label>
                            <input 
                                type="number" 
                                x-model.number="preview.current_turn" 
                                min="1" 
                                :max="spec.max_turns"
                                class="input-field"
                            />
                        </div>

                        <button 
                            @click="runPreview()" 
                            class="btn btn-primary"
                            :disabled="!spec.env_name"
                        >
                            Run Test
                        </button>

                        <!-- Results -->
                        <div x-show="preview.result" x-cloak class="result-card info">
                            <h3 class="font-bold text-blue-300 mb-3 text-sm uppercase tracking-wide">Test Results</h3>
                            <div class="space-y-2.5 text-sm">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-gray-300">Parsed Answer</span>
                                    <code class="bg-gray-900 px-3 py-1 rounded border border-blue-700 text-white font-mono text-xs" x-text="preview.result.parsed_answer || 'null'"></code>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-gray-300">Correctness</span>
                                    <span 
                                        :class="preview.result.is_correct ? 'text-green-400 font-bold' : 'text-red-400 font-bold'" 
                                        x-text="preview.result.is_correct ? 'Correct' : 'Incorrect'"
                                    ></span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-gray-300">Reward</span>
                                    <span class="font-mono font-bold text-white" x-text="preview.result.reward"></span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-gray-300">Episode Done</span>
                                    <span class="text-white font-medium" x-text="preview.result.done ? 'Yes' : 'No'"></span>
                                </div>
                                <div x-show="preview.result.feedback" x-cloak class="pt-2 border-t border-blue-700">
                                    <span class="font-semibold text-gray-300 block mb-1">Feedback</span>
                                    <p class="text-gray-200 bg-gray-900 p-2 rounded border border-blue-700 italic text-sm" x-text="preview.result.feedback"></p>
                                </div>
                            </div>
                        </div>

                        <div x-show="preview.error" x-cloak class="result-card error">
                            <p class="text-red-300 font-semibold text-sm" x-text="preview.error"></p>
                        </div>
                    </div>
                </section>

                <!-- Actions -->
                <section class="card">
                    <div class="p-6 space-y-3">
                        <button 
                            @click="saveSpec()" 
                            class="btn btn-success"
                            :disabled="!spec.env_name"
                        >
                            Save Specification
                        </button>
                        
                        <button 
                            @click="exportEnv()" 
                            class="btn btn-primary"
                            :disabled="!spec.env_name"
                        >
                            Export Environment Code
                        </button>

                        <div x-show="export.success" x-cloak class="result-card success">
                            <p class="text-green-300 font-bold text-sm mb-1">Export Successful</p>
                            <p class="text-green-200 text-sm" x-text="export.message"></p>
                        </div>

                        <div x-show="export.error" x-cloak class="result-card error">
                            <p class="text-red-300 font-semibold text-sm" x-text="export.error"></p>
                        </div>
                    </div>
                </section>

                <!-- Saved Environments -->
                <section class="card">
                    <div class="p-6 border-b border-gray-800">
                        <div class="flex items-center justify-between">
                            <h2 class="text-lg font-bold text-white">Saved Environments</h2>
                            <button 
                                @click="loadSpecs()" 
                                class="text-blue-500 hover:text-blue-400 text-sm font-semibold transition-colors duration-150"
                            >
                                Refresh
                            </button>
                        </div>
                    </div>
                    <div class="p-6">
                        <div x-show="savedSpecs.length === 0" class="text-center py-8 text-gray-500">
                            <p class="text-sm">No saved environments</p>
                        </div>

                        <div x-show="savedSpecs.length > 0" class="space-y-2">
                            <template x-for="name in savedSpecs" :key="name">
                                <div class="spec-item">
                                    <span class="font-mono text-sm font-semibold text-white" x-text="name"></span>
                                    <div class="flex items-center gap-4">
                                        <button 
                                            @click="loadSpec(name)" 
                                            class="icon-btn text-blue-500 hover:text-blue-400"
                                        >
                                            Load
                                        </button>
                                        <button 
                                            @click="deleteSpec(name)" 
                                            class="icon-btn text-red-500 hover:text-red-400"
                                        >
                                            Delete
                                        </button>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <script>
        function envBuilder() {
            return {
                spec: {
                    env_name: '',
                    env_type: 'single_turn',
                    max_turns: 3,
                    description: '',
                    parsing: {
                        method: 'regex',
                        pattern: '\\\\boxed\\{([^}]+)\\}',
                        json_path: '$.answer'
                    },
                    reward: {
                        method: 'exact_match',
                        correct_reward: 1.0,
                        incorrect_reward: 0.0,
                        partial_reward: null,
                        tolerance: 0.01
                    },
                    feedback: {
                        on_incorrect: "Your answer '{answer}' is incorrect. Please try again.",
                        on_format_error: "Please provide your answer in the correct format."
                    },
                    done_condition: 'always_single_step'
                },
                preview: { model_output: '', ground_truth: '', current_turn: 1, result: null, error: null },
                export: { success: false, error: null, message: '', files: [] },
                usePartialReward: false,
                savedSpecs: [],

                async runPreview() {
                    this.preview.result = null;
                    this.preview.error = null;
                    if (!this.validateSpec()) return;
                    try {
                        const response = await fetch('/api/preview', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                spec: this.spec,
                                model_output: this.preview.model_output,
                                ground_truth: this.preview.ground_truth,
                                current_turn: this.preview.current_turn
                            })
                        });
                        if (!response.ok) throw new Error((await response.json()).detail || 'Preview failed');
                        this.preview.result = await response.json();
                    } catch (e) { this.preview.error = e.message; }
                },
                
                async saveSpec() {
                    if (!this.validateSpec()) return;
                    try {
                        const response = await fetch('/api/specs', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: this.getSpecPayload()
                        });
                        if (!response.ok) throw new Error((await response.json()).detail || 'Save failed');
                        alert('Environment specification saved successfully');
                        this.loadSpecs();
                    } catch (e) { alert('Error: ' + e.message); }
                },
                
                async exportEnv() {
                    this.export.success = false;
                    this.export.error = null;
                    if (!this.validateSpec()) return;
                    try {
                        const response = await fetch('/api/export', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ spec: JSON.parse(this.getSpecPayload()) })
                        });
                        if (!response.ok) throw new Error((await response.json()).detail || 'Export failed');
                        const result = await response.json();
                        this.export.success = result.success;
                        this.export.message = result.message;
                        setTimeout(() => { this.export.success = false; }, 5000);
                    } catch (e) { this.export.error = e.message; }
                },
                
                async loadSpecs() {
                    try {
                        const response = await fetch('/api/specs');
                        if (response.ok) this.savedSpecs = await response.json();
                    } catch (e) { console.error('Error loading specs:', e); }
                },
                
                async loadSpec(name) {
                    try {
                        const response = await fetch(`/api/specs/${name}`);
                        if (response.ok) {
                            this.spec = await response.json();
                            this.usePartialReward = this.spec.reward.partial_reward !== null;
                            alert(`Loaded: ${name}`);
                        }
                    } catch (e) { alert('Error: ' + e.message); }
                },
                
                async deleteSpec(name) {
                    if (!confirm(`Delete "${name}"?`)) return;
                    try {
                        const response = await fetch(`/api/specs/${name}`, { method: 'DELETE' });
                        if (!response.ok) throw new Error((await response.json()).detail || 'Delete failed');
                        alert(`Deleted: ${name}`);
                        this.loadSpecs();
                    } catch (e) { alert('Error: ' + e.message); }
                },
                
                validateSpec() {
                    if (!this.spec.env_name.match(/^[a-z_][a-z0-9_]*$/)) {
                        alert('Environment name must be a valid Python identifier (lowercase, numbers, underscores)');
                        return false;
                    }
                    return true;
                },
                
                getSpecPayload() {
                    const payload = JSON.parse(JSON.stringify(this.spec));
                    if (!this.usePartialReward) payload.reward.partial_reward = null;
                    return JSON.stringify(payload);
                },
                
                init() {
                    this.loadSpecs();
                    this.$watch('usePartialReward', (value) => {
                        if (!value) {
                            this.spec.reward.partial_reward = null;
                        } else if (this.spec.reward.partial_reward === null) {
                            this.spec.reward.partial_reward = 0.5;
                        }
                    });
                }
            }
        }
    </script>
</body>
</html>
